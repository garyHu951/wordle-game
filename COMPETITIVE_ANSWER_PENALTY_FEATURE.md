# 對戰模式查看答案懲罰機制

## 功能概述
在對戰模式中實現了查看答案的懲罰機制：如果玩家選擇查看答案，則該回合即使答對也只能得到0分，而不是正常的5分。這個機制鼓勵公平競技，防止玩家過度依賴查看答案功能。

## 🎯 功能特點

### 懲罰機制
- **正常得分**: 答對題目獲得5分
- **查看答案後**: 即使答對也只得0分
- **公平競技**: 鼓勵玩家憑實力競爭
- **透明提示**: 清楚告知玩家懲罰規則

### 用戶體驗
- **事前警告**: 查看答案時顯示得分懲罰提示
- **結果反饋**: 回合結束時顯示懲罰信息
- **對手通知**: 對手可以看到你是否查看了答案

## 🔧 技術實現

### 後端實現

#### 1. 數據結構擴展
```javascript
// 房間數據結構新增字段
room.playersViewedAnswer = {
  [roundNumber]: {
    [playerId]: true/false
  }
}
```

#### 2. 查看答案處理
```javascript
socket.on('get_current_answer', ({ roomCode }) => {
  // 標記玩家已查看答案
  room.playersViewedAnswer[currentRound][socket.id] = true;
  
  // 發送答案和警告
  socket.emit('current_answer', {
    answer: roundWord,
    scoreWarning: true
  });
});
```

#### 3. 得分計算修改
```javascript
if (isCorrect) {
  // 檢查是否查看了答案
  const hasViewedAnswer = room.playersViewedAnswer?.[currentRound]?.[socket.id];
  
  // 根據是否查看答案決定得分
  const points = hasViewedAnswer ? 0 : 5;
  room.players[socket.id].score += points;
}
```

### 前端實現

#### 1. 警告提示
```javascript
newSocket.on('current_answer', ({ answer, scoreWarning }) => {
  setCurrentAnswer(answer);
  setShowAnswer(true);
  
  if (scoreWarning) {
    setMessage('⚠️ 查看答案後該回合得分為0分！');
  }
});
```

#### 2. 結果顯示
```javascript
newSocket.on('round_winner', (data) => {
  if (data.viewedAnswer && data.winnerId === socket.id) {
    setMessage('🏆 回合勝利！但因查看答案得分為0');
  }
});
```

#### 3. 對手通知
```javascript
newSocket.on('opponent_won_round', ({ word, points, viewedAnswer }) => {
  const answerInfo = viewedAnswer ? ' (查看答案，0分)' : '';
  setErrorMessage(`🎉 OPPONENT WON! Answer: "${word}" (+${points} PTS)${answerInfo}`);
});
```

## 📱 用戶界面

### 查看答案時的提示
- **警告信息**: "⚠️ 查看答案後該回合得分為0分！"
- **顯示時間**: 3秒後自動消失
- **顏色提示**: 使用警告色彩突出顯示

### 回合結束時的反饋
- **獲勝但0分**: "🏆 回合勝利！但因查看答案得分為0"
- **對手查看答案**: "🎉 OPPONENT WON! Answer: 'WORD' (+0 PTS) (查看答案，0分)"

## 🎮 遊戲流程

### 正常流程
1. 玩家開始猜測單字
2. 玩家答對獲得5分
3. 進入下一回合

### 查看答案流程
1. 玩家點擊"顯示答案"按鍵
2. 系統顯示警告："查看答案後該回合得分為0分"
3. 玩家看到答案
4. 玩家答對但只得0分
5. 系統顯示："回合勝利！但因查看答案得分為0"
6. 對手看到："OPPONENT WON! (+0 PTS) (查看答案，0分)"

## 🔍 功能細節

### 記錄機制
- **按回合記錄**: 每個回合獨立記錄
- **按玩家記錄**: 每個玩家獨立追蹤
- **實時更新**: 查看答案時立即記錄

### 得分邏輯
- **查看前答對**: 5分
- **查看後答對**: 0分
- **答錯**: 0分（無論是否查看答案）

### 透明度
- **自己知道**: 玩家清楚知道自己的懲罰
- **對手知道**: 對手可以看到你是否查看了答案
- **公平競技**: 避免隱藏的不公平優勢

## 📊 影響分析

### 遊戲平衡
- **鼓勵技巧**: 玩家更依賴自己的詞彙能力
- **減少依賴**: 降低對查看答案功能的過度使用
- **公平競爭**: 確保所有玩家在相同條件下競爭

### 用戶體驗
- **清晰規則**: 玩家明確了解懲罰機制
- **選擇權**: 玩家仍可選擇查看答案（在困難時）
- **策略性**: 增加了遊戲的策略考量

## 🛠️ 維護和擴展

### 可能的改進
1. **漸進懲罰**: 根據查看答案的時機調整懲罰程度
2. **統計追蹤**: 記錄玩家查看答案的頻率
3. **成就系統**: 為不查看答案的玩家提供獎勵
4. **難度調整**: 根據玩家水平調整懲罰機制

### 配置選項
- **房主設置**: 允許房主開啟/關閉懲罰機制
- **懲罰程度**: 可配置懲罰分數（如-1分、0分等）
- **提示開關**: 可選擇是否顯示對手的查看答案狀態

## 🔒 數據安全

### 防作弊
- **服務器驗證**: 所有得分計算在服務器端進行
- **狀態同步**: 客戶端無法偽造查看答案狀態
- **日誌記錄**: 服務器記錄所有查看答案行為

### 隱私保護
- **房間隔離**: 查看答案狀態僅在當前房間內可見
- **回合重置**: 每個新回合重新開始記錄

## 📈 測試建議

### 功能測試
- [ ] 查看答案後得分確實為0
- [ ] 警告信息正確顯示
- [ ] 對手能看到查看答案狀態
- [ ] 不同回合的記錄獨立

### 邊界測試
- [ ] 查看答案後立即答對
- [ ] 查看答案後答錯
- [ ] 多次查看答案
- [ ] 網絡中斷後的狀態恢復

### 用戶體驗測試
- [ ] 提示信息清晰易懂
- [ ] 懲罰機制不影響遊戲流暢度
- [ ] 對手通知信息準確

---

**實現時間**: 2024-12-25  
**影響範圍**: 僅對戰模式  
**向後兼容**: 完全兼容現有功能  
**用戶影響**: 提升競技公平性，鼓勵技能提升